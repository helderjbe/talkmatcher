!function(e){function t(t){for(var r,s,a=t[0],u=t[1],c=t[2],l=0,p=[];l<a.length;l++)s=a[l],o[s]&&p.push(o[s][0]),o[s]=0;for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(e[r]=u[r]);for(d&&d(t);p.length;)p.shift()();return i.push.apply(i,c||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],r=!0,a=1;a<n.length;a++){var u=n[a];0!==o[u]&&(r=!1)}r&&(i.splice(t--,1),e=s(s.s=n[0]))}return e}var r={},o={0:0},i=[];function s(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=r,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(n,r,function(t){return e[t]}.bind(null,r));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="";var a=window.webpackJsonp=window.webpackJsonp||[],u=a.push.bind(a);a.push=t,a=a.slice();for(var c=0;c<a.length;c++)t(a[c]);var d=u;i.push([144,1]),n()}({144:function(e,t,n){n(145),n(337),e.exports=n(338)},311:function(e,t,n){},333:function(e,t){},338:function(e,t,n){"use strict";n.r(t);n(310),n(311);var r=n(142),o=n.n(r),i=n(143),s=n.n(i);function a(e,t,n,r,o,i,s){try{var a=e[i](s),u=a.value}catch(e){return void n(e)}a.done?t(u):Promise.resolve(u).then(r,o)}function u(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function s(e){a(i,r,o,s,u,"next",e)}function u(e){a(i,r,o,s,u,"throw",e)}s(void 0)})}}var c=function(e,t,n,r){this.socketId=e,this.params=t,this.username=n,this.shouldOffer=r,this.bitrate=16,this.connection=null,this.voiceDetection=null,this.stream=null,this.enabledState=!0,this.div={}};c.prototype.OFFER_OPTIONS={offerToReceiveAudio:!0,offerToReceiveVideo:!1},c.prototype.sendEvent=function(e,t){X.emit("event",e,t)},c.prototype.setElements=function(e){this.div={div:e,audio:e.getElementsByTagName("audio")[0],user:e.getElementsByClassName("user")[0],mute:e.getElementsByClassName("mute")[0],range:e.querySelector("input[type=range]"),volume:e.getElementsByClassName("volume")[0],speaker:e.getElementsByClassName("speaker")[0]}},c.prototype.gotRemoteStream=function(e){var t=document.getElementById("elements"),n=document.getElementById("userElement"),r=document.createElement("div");r.insertAdjacentHTML("afterbegin",n.innerHTML),t.appendChild(r),this.setElements(r),this.div.audio.srcObject=e.streams[0],this.div.user.textContent=this.username,this.div.mute.addEventListener("click",function(){this.enabledState=!this.enabledState,this.muteAudioWatch(),this.div.mute.src=this.enabledState?"assets/icons/microphone.svg":"assets/icons/microphone-slash.svg",h.enabledAllState&&this.username&&(this.enabledState?J.changeLog("Unmuted "+this.username):J.changeLog("Muted "+this.username))}.bind(this)),this.div.volume.addEventListener("change",function(e){this.div.audio.volume=e.target.value,this.div.audio.volume>0?this.div.speaker.src="assets/icons/volume-up.svg":this.div.speaker.src="assets/icons/volume-off.svg"}.bind(this)),this.div.speaker.addEventListener("click",function(){this.div.audio.volume>0?(this.div.audio.volume=0,this.div.volume.value=0,this.div.speaker.src="assets/icons/volume-off.svg"):(this.div.audio.volume=1,this.div.volume.value=1,this.div.speaker.src="assets/icons/volume-up.svg")}.bind(this)),this.voiceDetection=s()(e.streams[0],{}),this.voiceDetection.resume(),this.voiceDetection.on("volume_change",function(e){var t=-1/e*35*this.div.audio.volume;this.div.range.style.boxShadow=t>=2?"0 0 2em #3097D1":e>=-60?"0 0 "+t+"em #3097D1":"none"}.bind(this)),this.muteAudioWatch()},c.prototype.stopStream=function(){this.stream&&(this.stream.getAudioTracks?this.stream.getAudioTracks().forEach(function(e){e.stop()}):this.stream.stop(),this.stream=null)},c.prototype.muteAudioWatch=function(){var e=null;this.stream&&((e=this.stream.getAudioTracks()[0])?e.enabled=h.enabledAllState&this.enabledState:"enabled"in this.stream&&(this.stream.enabled=h.enabledAllState&this.enabledState))},c.prototype.disconnect=function(){this.connection&&(this.connection.close(),this.connection=null),this.voiceDetection&&(this.voiceDetection.stop(),this.voiceDetection=null),this.stopStream(),this.div.div&&this.div.div.parentNode.removeChild(this.div.div)},c.prototype.handleConnection=function(e){e.candidate&&this.sendEvent({type:"candidate",label:e.candidate.sdpMLineIndex,candidate:e.candidate.candidate},this.socketId)},c.prototype.doOffer=u(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connection){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,this.connection.createOffer(this.OFFER_OPTIONS);case 5:return t=e.sent,e.next=8,this.setLocalSdp(t);case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),this.onError(e.t0,"createOffer");case 13:case"end":return e.stop()}},e,this,[[2,10]])})),c.prototype.setLocalSdp=function(){var e=u(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connection){e.next=2;break}return e.abrupt("return");case 2:return t.sdp=this.setAudioBandwidth(t.sdp),e.prev=3,e.next=6,this.connection.setLocalDescription(t);case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(3),this.onError(e.t0,"setLocalDescription");case 11:this.sendEvent({sdp:t.sdp,type:t.type},this.socketId);case 12:case"end":return e.stop()}},e,this,[[3,8]])}));return function(t){return e.apply(this,arguments)}}(),c.prototype.setRemoteSdp=function(){var e=u(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connection){e.next=2;break}return e.abrupt("return");case 2:return t.sdp=this.setAudioBandwidth(t.sdp),e.prev=3,e.next=6,this.connection.setRemoteDescription(new RTCSessionDescription(t));case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(3),this.onError(e.t0,"setRemoteDescription");case 11:case"end":return e.stop()}},e,this,[[3,8]])}));return function(t){return e.apply(this,arguments)}}(),c.prototype.onError=function(e,t){T.queue<=0?J.stopProcess():this.disconnect(),console.error('ERROR ON "'+t+'": ',e),this.username?J.changeLog("Error connecting to "+this.username,"red"):J.changeLog("Error connecting to peer")},c.prototype.doAnswer=u(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connection){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,this.connection.createAnswer();case 5:t=e.sent,this.setLocalSdp(t),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),this.onError(e.t0,"createAnswer");case 12:case"end":return e.stop()}},e,this,[[2,9]])})),c.prototype.build=u(regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connection=new RTCPeerConnection(this.params),this.connection.addEventListener("icecandidate",this.handleConnection.bind(this)),this.connection.addEventListener("track",this.gotRemoteStream.bind(this)),this.stream=h.localStream.clone(),this.stream.getAudioTracks().forEach(function(e){return t.connection.addTrack(e,t.stream)}),!this.shouldOffer){e.next=9;break}return e.next=8,this.doOffer();case 8:this.shouldOffer=!1;case 9:case"end":return e.stop()}},e,this)})),c.prototype.setAudioBandwidth=function(e){var t=e.split("\r\n"),n=this.findLine(t,"m=audio");if(null===n)return e;var r=this.findLineInRange(t,n+1,-1,"m=");null===r&&(r=t.length);var o=this.findLineInRange(t,n+1,r,"c=");if(null===o)return e;var i=this.findLineInRange(t,o+1,r,"b=AS");i&&t.splice(i,1);var s="b=AS:"+this.bitrate;return t.splice(o+1,0,s),e=t.join("\r\n")},c.prototype.findLine=function(e,t,n){return this.findLineInRange(e,0,-1,t,n)},c.prototype.findLineInRange=function(e,t,n,r,o,i){if(void 0===i&&(i="asc"),"asc"===(i=i||"asc")){for(var s=-1!==n?n:e.length,a=t;a<s;++a)if(0===e[a].indexOf(r)&&(!o||-1!==e[a].toLowerCase().indexOf(o.toLowerCase())))return a}else for(var u=-1!==t?t:e.length-1;u>=0;--u)if(0===e[u].indexOf(r)&&(!o||-1!==e[u].toLowerCase().indexOf(o.toLowerCase())))return u;return null};var d=c;function l(e,t,n,r,o,i,s){try{var a=e[i](s),u=a.value}catch(e){return void n(e)}a.done?t(u):Promise.resolve(u).then(r,o)}function p(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function s(e){l(i,r,o,s,a,"next",e)}function a(e){l(i,r,o,s,a,"throw",e)}s(void 0)})}}var h=function(){var e={},t=null,n=!0,r={sdpSemantics:"unified-plan",iceServers:[{urls:["turn:turn.talkmatcher.com"]},{urls:["stun:turn.talkmatcher.com"]}]},o={audio:!0,video:!1};function i(e){J.stopProcess(),J.changeLog(e,"red")}function s(){return(s=p(regeneratorRuntime.mark(function e(n){var o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&t.getAudioTracks&&0!==t.getAudioTracks().length){e.next=3;break}return i("No audio available"),e.abrupt("return");case 3:"key"in n&&Object.assign(r.iceServers[0],n.key),e.t0=regeneratorRuntime.keys(n.sockets);case 5:if((e.t1=e.t0()).done){e.next=13;break}if(o=e.t1.value,n.sockets.hasOwnProperty(o)){e.next=9;break}return e.abrupt("continue",5);case 9:return e.next=11,h(o,n.sockets[o],!0);case 11:e.next=5;break;case 13:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function a(){return(a=p(regeneratorRuntime.mark(function e(n,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=16;break}if(navigator.mediaDevices.getUserMedia){e.next=4;break}return i.bind(this,"Please update your browser"),e.abrupt("return");case 4:return e.prev=4,e.next=7,navigator.mediaDevices.getUserMedia(o);case 7:t=e.sent,X.emit("pair",n,r),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(4),i("Cannot find audio input. Accepted permissions?");case 14:e.next=19;break;case 16:u("peerConnections"),u("leave"),X.emit("pair",n,r);case 19:case"end":return e.stop()}},e,this,[[4,11]])}))).apply(this,arguments)}function u(){switch(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"leave"){case"localStream":t&&(t.getAudioTracks?t.getAudioTracks().forEach(function(e){e.stop()}):t.stop(),t=null);break;case"peerConnections":if(Object.keys(e).length&&e.constructor===Object){for(var n in e)e.hasOwnProperty(n)&&m(n);e={}}break;case"leave":X.emit("leave")}}function c(){return(c=p(regeneratorRuntime.mark(function t(n,r){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e[r]){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,t.next=5,e[r].connection.addIceCandidate(new RTCIceCandidate({sdpMLineIndex:n.label,candidate:n.candidate}));case 5:t.next=10;break;case 7:t.prev=7,t.t0=t.catch(2),i(t.t0);case 10:case"end":return t.stop()}},t,this,[[2,7]])}))).apply(this,arguments)}function l(){return(l=p(regeneratorRuntime.mark(function t(n,r){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e[r]){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,e[r].setRemoteSdp(n);case 4:"offer"===n.type&&e[r].doAnswer();case 5:case"end":return t.stop()}},t,this)}))).apply(this,arguments)}function h(e,t,n){return f.apply(this,arguments)}function f(){return(f=p(regeneratorRuntime.mark(function t(n,o,i){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e[n]=new d(n,r,o,i),t.next=3,e[n].build();case 3:case"end":return t.stop()}},t,this)}))).apply(this,arguments)}function m(t){e[t]&&(e[t].disconnect(t),delete e[t])}return{get peerConnections(){return e},get localStream(){return t},get timer(){return 0},get enabledAllState(){return n},get params(){return r},get streamConstraints(){return o},onError:i,recvAnswerError:function(e){J.changeLog(e,"red"),console.error("Error setting Remote Description after answer: "+e)},gotPair:function(e){return s.apply(this,arguments)},init:function(e,t){return a.apply(this,arguments)},muteAll:function(){for(var t in n=!n,e)e.hasOwnProperty(t)&&e[t].muteAudioWatch()},kill:u,stop:function(){t&&u("localStream"),e&&u("peerConnections"),u("leave")},addCandidate:function(e,t){return c.apply(this,arguments)},recvSdp:function(e,t){return l.apply(this,arguments)},newPeer:h,deletePeer:m}}();function f(e,t,n,r,o,i,s){try{var a=e[i](s),u=a.value}catch(e){return void n(e)}a.done?t(u):Promise.resolve(u).then(r,o)}function m(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function s(e){f(i,r,o,s,a,"next",e)}function a(e){f(i,r,o,s,a,"throw",e)}s(void 0)})}}n.d(t,"global",function(){return T}),n.d(t,"ui",function(){return J}),n.d(t,"socket",function(){return X}),n.d(t,"support",function(){return F}),n.d(t,"storage",function(){return W});var v,g=function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(v=document.querySelectorAll("#pair button"))||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(v)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}(),b=document.getElementById("stop"),y=document.getElementById("loader"),k=document.getElementById("log"),w=document.getElementById("username"),x=document.getElementById("muteAll"),S=document.getElementById("muteFx"),L=new Audio("assets/sounds/enter.mp3"),R=new Audio("assets/sounds/leave.mp3"),E=/^[\w\.\-\s]*$/,A=k.textContent,C=[];g.forEach(function(e){C.push(e.innerHTML)});var T={queue:-1,count:0,disabled:!1};window.onerror=function(e,t,n,r){var o=new XMLHttpRequest;return o.open("POST","https://talkmatcher.com/api/logger",!0),o.setRequestHeader("Content-Type","application/json"),o.send(JSON.stringify({message:e,source:t,lineno:n,colno:r})),!0};var O,P,I,M,_,j,U,D,N,B,q,F={supportsWebRTC:["RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection","RTCIceGatherer"].some(function(e){return e in window})},W=(O=!1,P={},{get useAux(){return O},get aux(){return P},isSupported:function(){try{return window.localStorage.setItem("__test__","__test__"),window.localStorage.removeItem("__test__"),!0}catch(e){return!1}},setItem:function(e,t){O?P[e]=t:window.localStorage.setItem(e,t)},getItem:function(e){return O?e in P?P[e]:null:window.localStorage.getItem(e)},setAux:function(){O=!0}}),H=(I=null,M=!1,j=function e(){if(_()<=5e3)return M&&!k.textContent.startsWith("Wait")?void(M=!1):(J.changeLog("Wait "+Math.round((5e3-_())/1e3)+" seconds to pair again","red"),M=!0,window.setTimeout(e.bind(this),1e3));M=!1,J.changeLog(A,"blue")},{get timer(){return I},get started(){return M},waitingTime:_=function(){return(new Date).getTime()-I},timerFunc:j,start:function(){if(!M)return!((I=W.getItem("timer"))&&_()<=5e3&&(j(),1))}}),J=(D=function(){if(-1!=T.queue&&T.count<=T.queue){N(y,!0);var e=T.queue-T.count+1;U(e>1?"Looking for "+e+" users":"Looking for "+e+" user","yellow")}else N(y,!1),U(A,"blue")},{changeLog:U=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";k.textContent=e,k.className=t},updateLoader:D,setUsernameFromStorage:function(){var e=W.getItem("name");e&&q(e)},playSound:function(e){e.play()},stopProcess:function(){h.stop(),B(!1),N(b,!1),g[T.queue].innerHTML=C[T.queue],T.queue=-1,D()},muteAllProcess:function(){h.muteAll(),h.enabledAllState?(x.src="assets/icons/microphone-all.svg",U("Unmuted Mic")):(x.src="assets/icons/microphone-all-slash.svg",U("Muted Mic"))},muteFxProcess:function(){L.muted&&R.muted?(L.muted=!1,R.muted=!1,S.src="assets/icons/note.svg",U("Unmuted notification sounds")):(L.muted=!0,R.muted=!0,S.src="assets/icons/note-slash.svg",U("Muted notification sounds"))},display:N=function(e,t){e.className=t?"":"hide"},disableUsername:B=function(e){w.disabled=!!e},getUsername:function(){return w.value},setUsername:q=function(e){w.value=e}}),X=o.a.connect("https://talkmatcher.com/");X.on("msg",function(){var e=m(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.type,e.next="candidate"===e.t0?3:"offer"===e.t0?6:"answer"===e.t0?6:"pair"===e.t0?9:"join"===e.t0?16:"leave"===e.t0?22:27;break;case 3:return e.next=5,h.addCandidate(t,n);case 5:return e.abrupt("break",28);case 6:return e.next=8,h.recvSdp(t,n);case 8:return e.abrupt("break",28);case 9:return T.count=Object.keys(t.sockets).length,J.updateLoader(),W.setItem("timer",(new Date).getTime()),e.next=14,h.gotPair(t);case 14:return J.display(b,!0),e.abrupt("break",28);case 16:return T.count++,J.updateLoader(),e.next=20,h.newPeer(n,t.username,!1);case 20:return J.playSound(L),e.abrupt("break",28);case 22:return T.count--,J.updateLoader(),h.deletePeer(n),J.playSound(R),e.abrupt("break",28);case 27:"string"==typeof t&&J.changeLog(t,"red");case 28:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()),X.on("connect_error",function(){J.changeLog("Connection to server lost","red"),T.disabled=!0,T.queue>=0&&!T.count&&J.stopProcess()}),X.on("reconnect",function(){J.changeLog("Reconnected","blue"),T.disabled=!1}),W.isSupported()||W.setAux(),J.getUsername()||J.setUsernameFromStorage(),F.supportsWebRTC?g.forEach(function(e){e.addEventListener("click",function(){var t=m(regeneratorRuntime.mark(function t(n){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!T.disabled){t.next=2;break}return t.abrupt("return");case 2:if(E.test(J.getUsername())){t.next=5;break}return J.changeLog("Special characters not allowed","red"),t.abrupt("return");case 5:if(J.getUsername().length){t.next=9;break}J.setUsername("Anonymous"),t.next=12;break;case 9:if(!(J.getUsername().length<2||J.getUsername().length>16)){t.next=12;break}return J.changeLog("Name should be 2 to 16 letters long","red"),t.abrupt("return");case 12:if(H.start()){t.next=14;break}return t.abrupt("return");case 14:return T.queue=parseInt(n.target.className.match(/\d+/)[0]),J.updateLoader(),"Anonymous"!==J.getUsername()&&W.setItem("name",J.getUsername()),J.disableUsername(!0),g.forEach(function(t,n){e.className!=t.className&&"NEXT"===t.innerHTML&&(t.innerHTML=C[n])}),e.innerHTML="NEXT",t.next=22,h.init(J.getUsername(),T.queue);case 22:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}())}):J.changeLog("WebRTC not supported, please use the app or another browser","red"),b.addEventListener("click",J.stopProcess),x.addEventListener("click",J.muteAllProcess),S.addEventListener("click",J.muteFxProcess)}});